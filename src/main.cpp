#include <stdio.h>
#include <stdlib.h>
#include <iostream>
#include <fstream>
#include <string.h>
#include "common.h"

int main(int argc, char **argv)
{
	std::string command(argv[1]);
	command = "readpe --format csv -i " + command;
	const char* c_str_command = command.c_str();

	FILE *result;
	char buffer[255];
	result = popen(c_str_command, "r");

	std::string current_library;

	while(fgets(buffer, 255, result) != NULL)
	{
		if(strncmp(buffer, "Library", 7) == 0)
		{
			if(fgets(buffer, 255, result) != NULL)
			{
				current_library = buffer;
			}
		}
		else if(strncmp(buffer, "Functions", 9) == 0)
		{
			continue;
		}
		else if(strncmp(buffer, "Function", 8) == 0)
		{
			if(fgets(buffer, 255, result) != NULL)
			{
				std::cout << "fn: " << buffer << "\n";
			}
		}
	}
	pclose(result);
}
